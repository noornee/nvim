local M = {
	"nvim-treesitter/nvim-treesitter",
	cmd = "TSUpdate",
	event = { "BufReadPost", "BufNewFile" },
	branch = "main",
}

M.config = function()
	local ensure_installed = {
		-- "c",
		-- "lua",
		"go",
		-- "bash",
		-- "python",
		-- "html",
		-- "javascript",
		-- "json",
		-- "nix",
		-- "rust",
		-- "vim",
		-- "vimdoc",
		-- "http",
		-- "sql",

		-- unsupported at the moment
		-- "norg",
		-- "jsonc",
	}

	require("nvim-treesitter").install(ensure_installed)

	-- took inspiration from this https://github.com/MeanderingProgrammer/treesitter-modules.nvim/tree/main?tab=readme-ov-file#do-i-need-this-plugin
	vim.api.nvim_create_autocmd("FileType", {
		group = vim.api.nvim_create_augroup("treesitter.setup", {}),
		callback = function(args)
			local buf = args.buf
			local filetype = args.match

			-- you need some mechanism to avoid running on buffers that do not
			-- correspond to a language (like oil.nvim buffers), this implementation
			-- checks if a parser exists for the current language
			local language = vim.treesitter.language.get_lang(filetype) or filetype
			if not vim.treesitter.language.add(language) then
				return
			end

			vim.treesitter.start(buf, language)

			-- replicate `indent = { enable = true }`
			-- vim.bo[buf].indentexpr = "v:lua.require'nvim-treesitter'.indentexpr()"
		end,
	})

	-- require("nvim-treesitter.configs").setup({
	-- 	-- A list of parser names, or "all"
	-- 	sync_install = false,
	-- 	highlight = {
	-- 		enable = true,
	-- 		additional_vim_regex_highlighting = false,
	-- 	},
	-- 	--indent = { enable = true }
	-- })
end

return M
